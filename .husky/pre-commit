#!/usr/bin/env sh
# ────────────────────────────────────────────────
# Husky v9+ compatible pre-commit hook
# ────────────────────────────────────────────────

echo "🔍 Running lint-staged on staged files (format & fix)..."
npx lint-staged
LINT_STAGED_EXIT_CODE=$?

if [ $LINT_STAGED_EXIT_CODE -ne 0 ]; then
  echo "❌ lint-staged failed. Please fix the errors and try again."
  exit 1
fi

echo "✅ lint-staged completed successfully."
echo "🔎 Running ESLint on the entire project to catch remaining errors..."
npx eslint . --ext .js,.ts
ESLINT_EXIT_CODE=$?

if [ $ESLINT_EXIT_CODE -ne 0 ]; then
  echo "❌ ESLint found errors in the project. Please fix them before committing."
  exit 1
fi

echo "✅ All checks passed! Proceeding with commit..."