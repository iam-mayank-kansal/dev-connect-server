#!/usr/bin/env sh
# ────────────────────────────────────────────────
# DevConnect's Advanced Pre-Commit Hook
# ────────────────────────────────────────────────

echo "🚀 Starting DevConnect Pre-Commit Checks..."
echo "────────────────────────────────────────────────"

# STEP 1: Format all files with Prettier
echo "💅 Step 1: Running Prettier to format code..."
npx prettier --write . --log-level warn

# Check which files were changed by Prettier
FORMATTED_FILES=$(git status --porcelain | grep '^[AM]' | awk '{print "   - " $2}')

if [ -n "$FORMATTED_FILES" ]; then
    echo "✨ Prettier automatically formatted the following files:"
    echo "$FORMATTED_FILES"
    echo "✅ Staging the new formatting changes..."
    git add .
else
    echo "👍 All files are perfectly formatted. No changes needed."
fi

echo "────────────────────────────────────────────────"

# STEP 2: Run ESLint to check for code quality issues
echo "🔍 Step 2: Running ESLint to check for errors..."
npx eslint . --ext .js,.ts
ESLINT_EXIT_CODE=$?

if [ $ESLINT_EXIT_CODE -ne 0 ]; then
    echo "❌ ESLint found errors! Your commit has been blocked."
    echo "   Please fix the errors listed above and try committing again."
    exit 1
fi

echo "✅ ESLint found no errors."
echo "────────────────────────────────────────────────"
echo "🎉 All checks passed! Your commit is good to go!"