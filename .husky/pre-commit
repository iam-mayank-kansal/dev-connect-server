#!/usr/bin/env sh
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# DevConnect's Advanced Pre-Commit Hook
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

echo "ğŸš€ Starting DevConnect Pre-Commit Checks..."
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

# STEP 1: Format all files with Prettier
echo "ğŸ’… Step 1: Running Prettier to format code..."
npx prettier --write . --log-level warn

# Check which files were changed by Prettier
FORMATTED_FILES=$(git status --porcelain | grep '^[AM]' | awk '{print "   - " $2}')

if [ -n "$FORMATTED_FILES" ]; then
    echo "âœ¨ Prettier automatically formatted the following files:"
    echo "$FORMATTED_FILES"
    echo "âœ… Staging the new formatting changes..."
    git add .
else
    echo "ğŸ‘ All files are perfectly formatted. No changes needed."
fi

echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

# STEP 2: Run ESLint to check for code quality issues
echo "ğŸ” Step 2: Running ESLint to check for errors..."
npx eslint . --ext .js,.ts
ESLINT_EXIT_CODE=$?

if [ $ESLINT_EXIT_CODE -ne 0 ]; then
    echo "âŒ ESLint found errors! Your commit has been blocked."
    echo "   Please fix the errors listed above and try committing again."
    exit 1
fi

echo "âœ… ESLint found no errors."
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "ğŸ‰ All checks passed! Your commit is good to go!"